---
phase: 06-tutorial-system
plan: 03
type: execute
wave: 3
depends_on: ["06-01", "06-02"]
files_modified:
  - src/components/tutorial/TutorialPanel.tsx
  - src/components/tutorial/TutorialLauncher.tsx
  - src/App.tsx
  - src/lib/tuning-orchestrator.ts
  - src/styles/tutorial.css
autonomous: false

must_haves:
  truths:
    - "User can see a Tutorial button in the app header and open a tutorial selection panel"
    - "User can launch any available tutorial and see driver.js highlighting actual UI elements"
    - "Tutorial steps with waitForAction auto-advance when user interacts with the targeted slider"
    - "First-time users see a dismissible suggestion to start the basics tutorial"
    - "Tutorial progress persists: completed tutorials show checkmarks, incomplete tutorials offer resume"
  artifacts:
    - path: "src/components/tutorial/TutorialPanel.tsx"
      provides: "Tutorial selection UI listing all tutorials with progress state"
      exports: ["TutorialPanel"]
    - path: "src/components/tutorial/TutorialLauncher.tsx"
      provides: "Header button to open/close the tutorial panel"
      exports: ["TutorialLauncher"]
    - path: "src/App.tsx"
      provides: "Tutorial launcher in header, first-time banner, TutorialPanel integration"
      contains: "TutorialLauncher"
  key_links:
    - from: "src/components/tutorial/TutorialPanel.tsx"
      to: "src/lib/tutorial/tutorial-engine.ts"
      via: "startTutorial() call on tutorial card click"
      pattern: "startTutorial"
    - from: "src/components/tutorial/TutorialPanel.tsx"
      to: "src/lib/tutorial/content/index.ts"
      via: "imports tutorials array for listing"
      pattern: "import.*tutorials.*from.*content"
    - from: "src/components/tutorial/TutorialPanel.tsx"
      to: "src/lib/tutorial/progress.ts"
      via: "isCompleted/getProgress for status display"
      pattern: "isCompleted|getProgress"
    - from: "src/App.tsx"
      to: "src/components/tutorial/TutorialLauncher.tsx"
      via: "renders TutorialLauncher in header"
      pattern: "TutorialLauncher"
    - from: "src/lib/tuning-orchestrator.ts"
      to: "src/lib/tutorial/tutorial-engine.ts"
      via: "notifyTutorialAction() on parameter change"
      pattern: "notifyTutorialAction"
---

<objective>
Create the tutorial UI components (TutorialPanel, TutorialLauncher), wire them into App.tsx, add a first-time user banner, and connect the tuning orchestrator to notify tutorial interactive steps when parameters change.

Purpose: Makes the tutorial system accessible to users. Completes the user-facing tutorial experience by connecting the engine (Plan 01) and content (Plan 02) to the UI.
Output: Users can launch, follow, and complete tutorials from within CaTune.
</objective>

<execution_context>
@/home/daharoni/.claude/get-shit-done/workflows/execute-plan.md
@/home/daharoni/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-tutorial-system/06-RESEARCH.md
@.planning/phases/06-tutorial-system/06-01-SUMMARY.md
@.planning/phases/06-tutorial-system/06-02-SUMMARY.md
@src/App.tsx
@src/lib/tuning-orchestrator.ts
@src/lib/tutorial/tutorial-engine.ts
@src/lib/tutorial/tutorial-store.ts
@src/lib/tutorial/content/index.ts
@src/styles/global.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TutorialPanel, TutorialLauncher, wire into App.tsx with first-time banner</name>
  <files>
    src/components/tutorial/TutorialPanel.tsx
    src/components/tutorial/TutorialLauncher.tsx
    src/App.tsx
    src/lib/tuning-orchestrator.ts
    src/styles/tutorial.css
  </files>
  <action>
**src/components/tutorial/TutorialLauncher.tsx:**
- A button component that toggles the TutorialPanel visibility
- Props: `isOpen: Accessor<boolean>`, `onToggle: () => void`
- Renders a button with text "Tutorial" (or "Close Tutorial" when open)
- Uses .btn-secondary .btn-small classes for consistency
- Add `data-tutorial="tutorial-launcher"` to the button

**src/components/tutorial/TutorialPanel.tsx:**
- Imports `tutorials` from '../../lib/tutorial/content'
- Imports `isCompleted`, `getProgress` from '../../lib/tutorial/progress'
- Imports `startTutorial` from '../../lib/tutorial/tutorial-engine'
- Imports `isTutorialActive` from '../../lib/tutorial/tutorial-store'
- Imports `importStep` from '../../lib/data-store' to check if data is loaded
- Renders a panel (positioned below the header, above the viz) listing all tutorials as cards
- Each tutorial card shows:
  - Title, description, level badge (beginner/intermediate/advanced), estimated time
  - Status: checkmark if completed, "Resume from step N" if in progress, "Start" if not started
  - Prerequisites: if not met (prerequisite tutorial not completed), show as locked with message "Complete [prerequisite] first"
  - If data is not loaded (importStep() !== 'ready'), show message: "Load data first to start tutorials" and disable all tutorial launch buttons
- On card click: if prerequisites met and data loaded, call `startTutorial(tutorial, resumeStep?)` and close the panel
- Panel is a `<div class="tutorial-panel">` with card layout matching CaTune's card system
- Add tutorial panel and card CSS rules to src/styles/tutorial.css (appending to the file created in Plan 01):
  - `.tutorial-panel`: background var(--bg-secondary), border-radius var(--radius-md), padding var(--space-lg), margin-bottom var(--space-md), max-height 400px, overflow-y auto
  - `.tutorial-card`: background var(--bg-surface), border-radius var(--radius-sm), padding var(--space-md), margin-bottom var(--space-sm), cursor pointer, border 1px solid transparent, transition border-color 0.15s
  - `.tutorial-card:hover`: border-color var(--accent)
  - `.tutorial-card--locked`: opacity 0.5, cursor not-allowed
  - `.tutorial-card--completed`: border-left 3px solid var(--success)
  - `.tutorial-card__title`: font-weight 600, margin-bottom var(--space-xs)
  - `.tutorial-card__meta`: font-size 0.85rem, color var(--text-secondary), display flex, gap var(--space-sm)
  - `.tutorial-card__description`: font-size 0.9rem, color var(--text-secondary), margin-top var(--space-xs)
  - `.tutorial-card__status`: font-size 0.8rem, margin-top var(--space-xs)
  - `.level-badge`: display inline-block, padding 2px 8px, border-radius var(--radius-sm), font-size 0.75rem, font-weight 600, text-transform uppercase
  - `.level-badge--beginner`: background rgba(46,204,113,0.15), color var(--success)
  - `.level-badge--intermediate`: background rgba(83,199,240,0.15), color var(--accent)
  - `.level-badge--advanced`: background rgba(240,165,0,0.15), color var(--warning)
  - `.tutorial-banner`: background var(--bg-surface), border-radius var(--radius-md), padding var(--space-md) var(--space-lg), margin-bottom var(--space-md), display flex, align-items center, justify-content space-between, gap var(--space-md)
  - `.tutorial-banner__text`: color var(--text-primary), font-size 0.9rem
  - `.tutorial-banner__actions`: display flex, gap var(--space-sm), align-items center
  - `.tutorial-banner__dismiss`: background none, border none, color var(--text-secondary), cursor pointer, font-size 1.2rem, padding var(--space-xs)

**src/App.tsx modifications:**
1. Import TutorialLauncher and TutorialPanel
2. Add a local signal for panel open state: `const [tutorialOpen, setTutorialOpen] = createSignal(false)`
3. Add a first-time banner signal: check localStorage key 'catune-tutorial-dismissed'. If not set and importStep() === 'ready', show a dismissible banner: "New to CaTune? Start with the basics tutorial to learn the parameter tuning workflow." with a "Start Tutorial" button (launches basics) and a dismiss "X" button (sets localStorage key)
4. Place TutorialLauncher in the app-header, next to the subtitle
5. Place TutorialPanel between the header and the viz section, shown conditionally with `<Show when={tutorialOpen()}>`. Close it when a tutorial starts (use createEffect on isTutorialActive to close panel when true)
6. Place the first-time banner above the viz-container, shown only when data is loaded and banner not dismissed

**src/lib/tuning-orchestrator.ts modifications:**
- Import `notifyTutorialAction` from './tutorial/tutorial-engine'
- Import `isTutorialActive` from './tutorial/tutorial-store'
- In the reactive effect that dispatches solver jobs on parameter changes, add: if `isTutorialActive()`, call `notifyTutorialAction()`. This makes interactive tutorial steps (waitForAction='slider-change') auto-advance when the user drags a slider during a tutorial.
- Guard: only call notifyTutorialAction if isTutorialActive() is true to avoid unnecessary work during normal use
  </action>
  <verify>
`npx tsc --noEmit` passes. `npm run build` succeeds. `npm run dev` -- open browser, verify: Tutorial button appears in header. Click it to see tutorial panel with 3 tutorials listed. Load demo data, then launch the basics tutorial -- driver.js overlay appears with dark-themed popover highlighting actual UI elements. Step through all 12 steps -- popovers reference correct elements. Stop tutorial. Check localStorage for progress. Verify interactive steps in workflow tutorial auto-advance on slider drag.
  </verify>
  <done>
TutorialLauncher button in header. TutorialPanel lists 3 tutorials with progress state, prerequisite gating, and data-loaded check. First-time banner shows for new users. Tuning orchestrator notifies tutorial engine on parameter changes for interactive step auto-advancement. Complete tutorial flow works end-to-end.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify tutorial system end-to-end</name>
  <files>src/App.tsx</files>
  <action>
Human verification of the complete tutorial system. All automation is done in Task 1.
Present the verification checklist to the user for manual testing in the browser.
  </action>
  <verify>
User confirms all 10 verification steps pass:
1. Tutorial button visible in header
2. Tutorial panel shows 3 tutorials with correct lock/unlock states
3. Data load required before tutorial launch
4. First-time banner appears and is dismissible
5. Basics tutorial highlights correct elements through all steps
6. Dark theme popover styling matches CaTune
7. Workflow tutorial interactive steps respond to slider drag
8. Progress persists across page refresh
9. Prerequisite gating works (workflow unlocks after basics)
10. First-time banner stays dismissed after refresh
  </verify>
  <done>User types "approved" confirming the tutorial system works correctly end-to-end.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. `npm run build` succeeds
3. Tutorial button visible in header
4. Tutorial panel lists all 3 tutorials with correct levels and prerequisites
5. Driver.js tour launches with dark theme and highlights correct elements
6. Interactive steps respond to slider interaction
7. Progress persists to localStorage
8. First-time banner shows once and dismisses permanently
</verification>

<success_criteria>
- TUTR-01: User can follow basics tutorial learning what each parameter does
- TUTR-02: User can follow guided workflow with interactive slider steps that wait for action
- TUTR-03: User can access advanced tutorial after completing workflow
- TUTR-04: Tutorial steps highlight actual UI elements via data-tutorial selectors
- TUTR-05: Tutorial content is data-driven (content modules have zero engine imports)
- Progress persistence across page refreshes
- First-time user guidance via dismissible banner
</success_criteria>

<output>
After completion, create `.planning/phases/06-tutorial-system/06-03-SUMMARY.md`
</output>
